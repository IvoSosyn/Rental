<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <style type="text/css">
        .ui-text-red {
            color: #c61e40;
        }
    </style>
    <h:body>
        <ui:composition>	
            <div class="ui-g">
                <div class="ui-g-7">
                    <h:form id="formModelTree">
                        <p:growl id="messages" showDetail="true" />                
                        <p:panelGrid columns="1">
                            <f:facet name="header">
                                Entita (Objekt evidence)
                            </f:facet>
                            <p:tree id="modelTree" value="#{modelTree.root}" var="treeNode"  selectionMode="single"
                                    selection="#{modelTree.selectedNode}" draggable="true" droppable="true" dropCopyNode="true" >
                                <p:ajax event="dragdrop" listener="#{modelTree.onDragDrop}" update=":formModelTree :formModelTreeDetail :formModelTable :formModelDetail  :formModelTree:modelTreeMenu :formModelTreeDetail:gridDetail :formModelTreeDetailButtons:addTypentity :formModelTreeDetailButtons:delTypentity :formModelTree:messages" >
                                    <f:attribute name="treeNode" value="#{treeNode}" />
                                </p:ajax>
                                <p:ajax event="select"  listener="#{modelTree.onNodeSelect}" update=":formModelTable :formModelDetail :formModelTree:modelTreeMenu :formModelTreeDetail:gridDetail :formModelTreeDetailButtons:addTypentity :formModelTreeDetailButtons:delTypentity :formModelTree:messages">
                                    <f:attribute name="treeNode" value="#{treeNode}" />
                                </p:ajax>
                                <p:ajax event="unselect" listener="#{modelTable.onNodeUnselect}"  update=":formModelTable :formModelDetail :formModelTree:modelTreeMenu :formModelTreeDetail:gridDetail :formModelTreeDetailButtons:addTypentity :formModelTreeDetailButtons:delTypentity :formModelTree:messages">
                                    <f:attribute name="treeNode" value="#{treeNode}" />
                                </p:ajax>
                                <p:treeNode expandedIcon="pi pi-folder-open" collapsedIcon="pi pi-folder">
                                    <h:outputText value="#{treeNode}"/>
                                </p:treeNode>
                            </p:tree>
                        </p:panelGrid>
                        <p:contextMenu id="modelTreeMenu" for="modelTree" >
                            <p:menuitem value="Přidej"  action="#{modelTree.addTypentity}" update=":formModelTree:modelTree :formModelTreeDetail:gridDetail"  icon="fa fa-plus"   title="Přidej novou entitu (uzel)" />
                            <p:menuitem value="Smaž"    action="#{modelTree.deleteNode}"   update=":formModelTree:modelTree :formModelTreeDetail:gridDetail"  icon="fa fa-ban"  disabled="#{!modelTree.editable}"  title="Smaž entitu (uzel)" >
                                <p:confirm header="Potvrzení akce" message="Opravdu chcete záznam smazat ?" icon="pi pi-exclamation-triangle" />
                            </p:menuitem>
                            <p:separator /> 
                            <p:menuitem value="Kopíruj" action="#{modelTree.copyNodeFrom}" update=":formModelTreeDetail:gridDetail"  icon="fa fa-copy" disabled="#{modelTree.selectedNode eq null }"  title="Zkopíruj entitu (uzel) do paměti"/>
                            <p:menuitem value="Vlož"    action="#{modelTree.pasteNodeTo}"  update=":formModelTree:modelTree :formModelTreeDetail:gridDetail"  icon="fa fa-paste" disabled="#{modelTree.selectedNode eq null or modelTree.copyNode eq null}"  title="Vloží entitu (uzel) z paměti do vybraného místa" />
                        </p:contextMenu>
                    </h:form>
                </div>
                <div class="ui-g-1">
                    <h:form id="formModelTreeDetailButtons">
                        <p:commandButton id="addTypentity" value="Přidej" process="@this" actionListener="#{modelTree.addTypentity}" update=":formModelTree:modelTree :formModelTreeDetail:gridDetail" partialSubmit="true" title="Přidej novou entitu (uzel)"  icon="fa fa-plus" />
                        <p:commandButton id="delTypentity" value="Smaž" process="@this" actionListener="#{modelTree.deleteNode}"  update=":formModelTree:modelTree :formModelTreeDetail:gridDetail"  partialSubmit="true" style="color: #c61e40;" disabled="#{!modelTree.editable}" icon="fa fa-ban" title="Smazání entity (uzlu)"  >
                            <p:confirm  header="Potvrzení akce" message="Opravdu chcete záznam smazat ?" icon="pi pi-exclamation-triangle" />
                        </p:commandButton>                        
                        <p:confirmDialog  global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="Ano" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                            <p:commandButton value="Ne" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
                        </p:confirmDialog>  
                    </h:form>
                </div>  
            </div>
            <div class="ui-g">
                <div class="ui-g-8">
                    <h:form id="formModelTreeDetail">
                        <p:panelGrid id="gridDetail" columns="2">
                            <f:facet name="header">
                                Detail entity #{modelTree.typentity.newEntity?"NOVÁ":""}
                            </f:facet>
                            <h:outputText value="Zkratka:"  />
                            <p:inputText id="idTypentity" value="#{modelTree.typentity.typentity}" disabled="#{modelTree.typentity eq null}" >
                                <p:ajax process="idTypentity" event="valueChange" listener="#{modelTree.valueChange(modelTree.typentity.typentity)}" />
                                <f:param name="fieldName" value="modelTree.typentity.typentity" />
                                <f:param name="fieldValue" value="#{modelTree.typentity.typentity}" />
                                <f:param name="typEntity.id" value="#{modelTree.typentity.id}" />
                            </p:inputText>
                            <h:outputText value="Popis:"  />
                            <p:inputText id="idPopis" value="#{modelTree.typentity.popis}"  disabled="#{modelTree.typentity eq null}"  > 
                                <p:ajax process="idPopis" event="valueChange" listener="#{modelTree.valueChange(modelTree.typentity.popis)}" />
                                <f:param name="fieldName" value="modelTree.typentity.popis" />
                                <f:param name="fieldValue" value="#{modelTree.typentity.popis}" />
                                <f:param name="typEntity.id" value="#{modelTree.typentity.id}" />
                            </p:inputText>
                            <h:outputText value="Platí Od:" />
                            <p:datePicker value="#{modelTree.typentity.platiod}" locale="cs_CZ" monthNavigator="true" pattern="dd.MM.yyyy" showButtonBar="true" showIcon="true" showOnFocus="false" disabled="#{modelTree.typentity eq null}"  title=" Prázdné pole(neomezeně) nebo OD kdy položka platí"  />
                            <h:outputText value="Do:" />
                            <p:datePicker value="#{modelTree.typentity.platido}" locale="cs_CZ" monthNavigator="true" pattern="dd.MM.yyyy" showButtonBar="true" showIcon="true" showOnFocus="false" disabled="#{modelTree.typentity eq null}" title=" Prázdné pole (neomezeně) nebo DO kdy položka platí" />
                            <h:outputText value="Systém:" />
                            <h:selectBooleanCheckbox value="#{modelTree.typentity.attrsystem}" disabled="true" />
                        </p:panelGrid>
                    </h:form>
                </div>
            </div>
        </ui:composition>
    </h:body>
</html>

